<html>
<head>
    <title>TonConnect Test</title>
</head>
<body>

<script>
    try {
        let tonClients = [];

        function checkWithWasm(){
            if(tonClients[0].setWasmOptions) {
                window.TONClient = tonClients[0];
            } else {
                window.TONClient = tonClients[1];
            }
            console.log(window.TONClient, tonClients);
        }


        console.log(window.TONClient);
        Object.defineProperty(window, 'TONClient', {
            get: function () {
                return window._TONClient
            }, set: (val) => {
                window._TONClient = val;
                tonClients.push(TONClient);
                console.log(TONClient)
                if(tonClients.length===2){
                    checkWithWasm();
                }
            }
        });


    }catch (e) {
        console.log('YandexBrowser Workaround', e)
    }
</script>

<script type="module">




    import {default as getProvider, PROVIDERS, UTILS} from "https://tonconnect.svoi.dev/freeton/getProvider.mjs";

    window.getProvider = getProvider;
    window.PROVIDERS = PROVIDERS;
    window.UTILS = UTILS;


    const DEFAULT_WALLET = PROVIDERS.TonWallet;

    let TON = null;
    //try {

        //Initialize provider
        TON = await getProvider({}, DEFAULT_WALLET);
        await TON.requestPermissions();
        await TON.start();
    /*} catch (e) {
        console.log(e);
        TON = await getProvider({
            network: 'main',
            networkServer: 'main2.ton.dev'
        }, PROVIDERS.TonBackendWeb);
        await TON.requestPermissions();
        await TON.start();

    }*/
    window.TON = TON;

    console.log('CURRENT WALLET', await TON.getWallet());

</script>
</body>
</html>